<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图片管理</title>
	<link rel="stylesheet" type="text/css" href="${request.contextPath}/themes/css/easyui.css">
	<link rel="stylesheet" type="text/css" href="${request.contextPath}/themes/css/icon.css">
	<!-- <link rel="stylesheet" type="text/css" href="demo.css"> -->
	<script src="${request.contextPath}/js/jquery-1.12.3.min.js"></script>
	<script type="text/javascript" src="${request.contextPath}/js/jquery.min.js"></script>
	<script type="text/javascript" src="${request.contextPath}/js/jquery.easyui.min.js"></script>
<script type="text/javascript">
$(function(){ 
	
	$('#img_tabs').tabs({
	    border:false,
	    onSelect:function(title){
	    	$('#table_'+ title).datagrid({
	    		loadMsg: '正在加载，请稍候...',
	    		singleSelect: false,
	    		fit: true,
	    		nowrap: false,
	    		fitColumns: true,
	    		pagination: true,
	    		rownumbers: true,
	    		idField: 'id',
	    		queryParams: {parentTitle: title},
	    		url: '<@url value="/cms/images/find"/>',
	    		columns: [[
	    			{field: 'ck', checkbox:true, width: 5, align: 'center'},
	    		    {field: 'title', title: '标题', width: 20, align: 'center'},
	    		    {field: 'imgUrl', title: '图片地址', width: 30, align: 'center'},
	    		    {field: 'orderIndex', title: '排序号', width: 10, align: 'center'},
	    		    {field: 'operate', title: '操作', width: 20, align: 'center',
	    				formatter: function(value, rec) {
	    					return '<a href="<@url value="/cms/images/view/'+ rec.id +'" />">View</a>';
	    				}
	    			}
	    			
	    		]],
	    		toolbar: [{
	    			text: "新增",
	    			handler: function(){
	    				window.location.href='<@url value="/cms/images/edit/new?parentTitle="/>' + title;
	    			}
	    		},'-',{
	    			text: "删除",
	    			handler: function(){del(title);}
	    		}]
	    	});
	    }
	});
	
	//删除
	function del(title) {
		var sels = $('#table_'+ title).datagrid('getSelections');
		if (sels.length == 0) {
			$.messager.alert('操作提示', '请选择要删除的记录！', 'warning');
		}else{
			$.messager
			.confirm('操作提示', '您确认要删除选中的&nbsp;<font size=5 color = red>'
							+ (sels.length) + '</font>&nbsp;条记录吗？',
					function(r) {
								if (r) {
									var ids = "";
									for (var i = 0; i < sels.length; i++) {
										ids += sels[i].id + ",";
									}
									$.ajax({
										   type: "POST",
										   url: "<@url value='/cms/images/delete'/>",
										   data: "ids="+ids,
										   success: function(msg){
											   $('#table_'+ title).datagrid("clearSelections");
											   $('#table_'+ title).datagrid('reload');
										   }
										});
								}
							});
		}
	}
	
	//var tab = $('#img_tabs').tabs('getSelected');
	//var index = $('#img_tabs').tabs('getTab',tab);
	$('#img_tabs').tabs('select',1);
	$('#img_tabs').tabs('select',0);
	//console.info($('#img_tabs').tabs('getTab',title));
})
</script>
</head>
<body>
<div id="img_tabs" class="easyui-tabs" style="width:700px;height:250px">
   <#if parentList??>
    	<#list parentList as parent>
	     <div title="${parent.title}" id="${parent_index}" data-options="closable:false" style="padding:10px">
	    	<table id="table_${parent.title}"></table>
	    </div>
    	</#list>
    </#if>
</div>
</body>
</html>